# 14. フィードバック機能

**Status**: TODO
**Priority**: 中
**Depends on**: 11-audio-player

## 概要

再生後のアンケートと行動データの収集機能。

## 関連する要件

- 4.7 フィードバック収集機能（REQUIREMENTS.md）
- 11. 成功指標（KPI）（REQUIREMENTS.md）

## Tasks

### アンケート機能
- [ ] 再生完了後の5段階評価UI
- [ ] 星評価コンポーネント
- [ ] 自由記述コメント入力（任意）
- [ ] 送信確認
- [ ] 送信完了メッセージ

### 行動データ収集
- [ ] 再生開始イベント記録
- [ ] 再生完了イベント記録
- [ ] 離脱ポイント（秒数）の記録
- [ ] 2回目以降の生成イベント記録

### データ分析用
- [ ] playback_logsへの詳細ログ保存
- [ ] feedbacksへのアンケート結果保存

### API
- [ ] POST /api/feedbacks（フィードバック送信）
- [ ] POST /api/playback-logs（再生ログ記録）

## KPI指標

| 指標                | 説明                               |
| ------------------- | ---------------------------------- |
| 初回生成完了率      | クエスト登録から生成完了までの割合 |
| 生成後の再生率      | 生成完了後に実際に再生した割合     |
| 再生完了率          | 最後まで聴いた割合                 |
| 有料転換率          | 無料1章から有料購入した割合        |
| 2回目クエスト生成率 | 2冊目以降を生成した割合            |

## ファイル構成

```
src/
├── app/
│   └── (protected)/
│       └── play/
│           └── [chapterId]/
│               └── components/
│                   └── FeedbackModal.tsx
├── components/
│   └── feedback/
│       ├── StarRating.tsx
│       └── CommentInput.tsx
└── lib/
    └── analytics/
        └── tracker.ts
```

## 完了条件

- 再生後に5段階評価が表示される
- 評価とコメントが保存される
- 再生ログが記録される
