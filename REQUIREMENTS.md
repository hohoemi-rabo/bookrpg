# Book RPG 要件定義書

**バージョン**: 1.0  
**作成日**: 2026年1月17日  
**ステータス**: MVP開発用

---

## 1. プロジェクト概要

### 1.1 サービス名

**Book RPG**

### 1.2 コンセプト

「その知識は、物語の中で『武器』になる」

### 1.3 サービス定義

任意の本や学習テーマを、**「自分が主人公のRPG風音声ストーリー」に変換して聴けるWebサービス**

### 1.4 目的

活字での学習が苦手なユーザーに対し、知識を「自分が主人公の物語体験」に変換することで、学習の継続と理解を促進する。単なるオーディオブックではなく **「学びのエンタメ化」** を実現する。

---

## 2. ターゲットユーザー

### 2.1 ペルソナ

- **年齢層**: 20〜50代
- 知識欲はあるが、活字が苦手
- ビジネス書・自己啓発本を買うが読破できない
- 通勤・家事・散歩など「ながら時間」を持っている
- RPG・物語・世界観への没入が好き

### 2.2 利用シーン

- 通勤中の移動時間
- 家事・散歩・作業中のBGM代わり
- 寝る前の軽いインプット

---

## 3. 技術スタック

| カテゴリ        | 技術                                                |
| --------------- | --------------------------------------------------- |
| フロントエンド  | Next.js（App Router）                               |
| バックエンド/DB | Supabase                                            |
| AI              | Gemini 2.5（テキスト生成 + TTS + 画像/PDF読み取り） |
| ホスティング    | Cloudflare Pages                                    |
| 非同期処理      | Cloudflare Queues                                   |
| ストレージ      | Cloudflare R2                                       |
| 決済            | Stripe                                              |
| 認証            | Google OAuth（Supabase Auth経由）                   |

---

## 4. 機能要件

### 4.1 認証機能

| 項目           | 内容                          |
| -------------- | ----------------------------- |
| 認証方式       | Google OAuth（Supabase Auth） |
| セッション管理 | Supabase標準                  |

---

### 4.2 クエスト登録機能（本・テーマ入力）

#### 4.2.1 入力方式（ハイブリッド）

**方式A: タイトル入力**

- 本のタイトルをテキスト入力
- 注意書き表示：「正確なタイトルを入力してください」
- AIが本の内容を推測して生成

**方式B: 画像/PDFアップロード**

- 対応形式：PDF、JPG、PNG
- 目次ページや該当ページをアップロード
- Gemini 2.5で内容を読み取り

**入力フロー**

1. ユーザーがタイトル入力 or ファイルアップロード
2. AIが把握した本の概要を表示
3. 「この内容で合っていますか？」と確認
4. 違っていたら、追加で画像/PDFをアップロード可能
5. 確認後、世界観・BGMを選択して生成開始

#### 4.2.2 世界観選択（プルダウン）

- ファンタジー
- SF
- 学園ドラマ

#### 4.2.3 BGM選択

- 世界観ごとに3曲ずつ用意（計9曲）
- フリー音源を使用（自前で用意）

---

### 4.3 ストーリー変換機能（生成）

#### 4.3.1 変換ルール

| 原作要素   | RPG変換後              |
| ---------- | ---------------------- |
| 主人公     | ユーザー（二人称視点） |
| 教え・知識 | 魔法 / スキル          |
| 課題・問題 | モンスター / 試練      |
| 解決策     | 必殺技 / 選択          |

#### 4.3.2 生成パターン

**パターンA: 本全体を1ストーリー**

- 全体で約10分の音声
- 本の主要な教えを1つの物語にまとめる

**パターンB: 章ごとに分割**

- AIが本の構成を推測して5章程度に分割
- 1章あたり約2分
- 各章の終わりは「次が気になる引き」で終わらせる

#### 4.3.3 出力形式

- ナレーション用テキスト（章構成）
- 全体で約10分程度の音声尺

---

### 4.4 音声生成機能

#### 4.4.1 使用技術

- **TTS**: Gemini 2.5 TTS
- **ナレーション**: 単一音声（男女切替は将来検討）

#### 4.4.2 音声構成

- ナレーション音声（TTS）
- BGM（ユーザー選択のフリー音源）
- 効果音：**MVPでは非対応**

#### 4.4.3 音声合成

- サーバー側でナレーション音声とBGMを合成
- 1つの音声ファイルとして出力
- Cloudflare Queuesで非同期処理

#### 4.4.4 生成中のUX

- プログレスバー表示
- 「冒険の準備中...」等のRPG風演出
- 注意書き：「ブラウザを閉じないでください」

#### 4.4.5 生成失敗時の対応

1. 自動リトライ（最大3回）
2. それでも失敗 → 手動再生成ボタン表示
3. 有料購入後の失敗が続く場合 → 返金対応（Stripe経由）

---

### 4.5 再生・ライブラリ機能

#### 4.5.1 再生プレイヤー機能（MVP）

- 再生 / 一時停止
- シークバー（任意の位置から再生）
- 再生速度変更（0.5x〜2x）

#### 4.5.2 将来追加（Phase2）

- 10秒スキップ / 戻る
- バックグラウンド再生

#### 4.5.3 ライブラリ機能

- 再生済みクエストの保存
- ライブラリ一覧表示（章タイトル + 世界観）

---

### 4.6 音声ファイル保存

| 区分           | 保存先        | 保存期間 |
| -------------- | ------------- | -------- |
| 有料購入した章 | Cloudflare R2 | 無期限   |
| 無料の1章      | Cloudflare R2 | 7日間    |

---

### 4.7 フィードバック収集機能

#### 4.7.1 アンケート

- 再生後に5段階評価を表示
- 任意で自由記述コメント

#### 4.7.2 行動データ

- 再生開始率
- 再生完了率
- 離脱ポイント
- 2回目以降の生成率

---

## 5. ビジネスモデル

### 5.1 料金体系

| プラン           | 内容             | 価格 |
| ---------------- | ---------------- | ---- |
| 無料             | 1冊につき1章のみ | ¥0   |
| 有料（買い切り） | 残りの章すべて   | ¥200 |

### 5.2 決済

- Stripe Checkout使用
- 手数料：3.6%（200円の場合、約7円）

### 5.3 無料ユーザーの制限

- 1冊につき1章のみ生成・再生可能
- 無料章は7日間で削除

---

## 6. 世界観演出

### 6.1 実装優先順位

| 優先度 | 演出                 | MVP対応         |
| ------ | -------------------- | --------------- |
| 最優先 | ストーリーの舞台設定 | ○               |
| 高     | BGMの雰囲気連動      | ○               |
| 中     | UIデザイン変化       | △（間に合えば） |

### 6.2 世界観別の演出

| 世界観       | ストーリー設定 | BGM雰囲気          | UI（Phase2）       |
| ------------ | -------------- | ------------------ | ------------------ |
| ファンタジー | 剣と魔法の世界 | オーケストラ風     | 羊皮紙風・装飾文字 |
| SF           | 宇宙・未来都市 | シンセ・エレクトロ | ネオン・サイバー   |
| 学園ドラマ   | 学校・部活     | ポップ・青春系     | 黒板・ノート風     |

---

## 7. 管理画面（ダッシュボード）

### 7.1 機能一覧

| 機能         | 内容                         |
| ------------ | ---------------------------- |
| ユーザー統計 | 登録数・アクティブユーザー数 |
| 生成統計     | 生成数・成功率・失敗率       |
| 売上確認     | 日別・月別売上（Stripe連携） |
| エラーログ   | 生成失敗の詳細ログ           |
| ユーザー検索 | 特定ユーザーのデータ確認     |

---

## 8. UI/UXデザイン方針

### 8.1 基本方針

- **ゲームっぽさ**を全面に押し出す
- 「学習感」を出さない
- RPGのメニュー画面・クエスト受注画面のような雰囲気
- 操作数は極力少なく

### 8.2 デザインイメージ

- クエスト登録 → 「依頼を受ける」感覚
- 生成中 → 「冒険の準備」演出
- 再生 → 「クエスト開始」
- ライブラリ → 「冒険の記録」

---

## 9. 非機能要件

### 9.1 対応デバイス

- スマートフォン（最優先）
- PC（副次対応）

### 9.2 パフォーマンス

- 音声生成：数十秒〜数分許容（非同期処理）
- 再生：生成完了後に再生可能

### 9.3 セキュリティ

- HTTPS必須
- Supabase RLS（Row Level Security）でデータ保護
- Stripe Webhookの署名検証

---

## 10. 法的対応

### 10.1 必要ページ

- 利用規約（個人学習目的のみと明記）
- プライバシーポリシー
- 特定商取引法に基づく表記

### 10.2 著作権方針（MVP）

- 利用規約で「個人学習目的のみ」と明記
- 生成物の再配布禁止を明記

---

## 11. 成功指標（KPI）

| 指標                | 説明                               |
| ------------------- | ---------------------------------- |
| 初回生成完了率      | クエスト登録から生成完了までの割合 |
| 生成後の再生率      | 生成完了後に実際に再生した割合     |
| 再生完了率          | 最後まで聴いた割合                 |
| 有料転換率          | 無料1章から有料購入した割合        |
| 2回目クエスト生成率 | 2冊目以降を生成した割合            |

---

## 12. MVPの判断基準

この問いにYESなら成功：

- 「勉強なのに、続きを聴きたくなるか？」
- 「内容を思い出す時、物語として記憶されているか？」
- 「他人に説明したくなるか？」

---

## 13. MVPでやらないこと（明示的に除外）

- プロ声優の起用
- 効果音の細かな演出
- 分岐選択型ストーリー
- 成績・レベル・数値化
- SNS共有機能
- 10秒スキップ / バックグラウンド再生

---

## 14. 将来拡張（Phase2以降）

| 機能                 | 説明                             |
| -------------------- | -------------------------------- |
| UIデザイン変化       | 世界観ごとにUI全体のデザイン変更 |
| 音声キャラクター選択 | 複数の声優/音声から選択          |
| 効果音・臨場感強化   | SE追加で没入感向上               |
| 分岐ストーリー       | 選択肢で展開が変わる             |
| プレイリスト管理     | 複数クエストをサーガとして管理   |
| 高音質オプション     | 有料プランで音質向上             |
| 10秒スキップ         | 再生プレイヤー機能追加           |
| バックグラウンド再生 | スマホ対応                       |

---

## 15. 一言で言うと

**Book RPG は「勉強を、思い出せる体験に変えるサービス」である。**

---

## 付録A: 画面一覧

| 画面名               | 説明                             |
| -------------------- | -------------------------------- |
| ランディングページ   | サービス紹介・ログイン導線       |
| ログイン             | Google OAuth                     |
| クエスト登録         | 本のタイトル入力 or アップロード |
| 内容確認             | AIが把握した概要の確認           |
| 世界観・BGM選択      | 設定選択画面                     |
| 生成中               | プログレス表示                   |
| 再生画面             | オーディオプレイヤー             |
| ライブラリ           | 過去のクエスト一覧               |
| 購入画面             | Stripe Checkout                  |
| 設定                 | アカウント管理                   |
| 利用規約             | 法的文書                         |
| プライバシーポリシー | 法的文書                         |
| 特商法表記           | 法的文書                         |
| 管理画面             | 運営者向けダッシュボード         |

---

## 付録B: データベース設計（概要）

### users

- id, email, google_id, created_at, updated_at

### books

- id, user_id, title, input_type (title/upload), file_url, ai_summary, created_at

### quests（生成されたストーリー）

- id, book_id, user_id, world_type, bgm_id, chapter_count, status, created_at

### chapters

- id, quest_id, chapter_number, title, script_text, audio_url, is_free, is_purchased, created_at

### purchases

- id, user_id, quest_id, stripe_payment_id, amount, status, created_at

### feedbacks

- id, user_id, quest_id, rating (1-5), comment, created_at

### playback_logs

- id, user_id, chapter_id, played_at, completed, playback_duration, dropped_at_seconds

---

## 付録C: API設計（概要）

| エンドポイント           | メソッド | 説明               |
| ------------------------ | -------- | ------------------ |
| /api/auth/google         | GET      | Google OAuth       |
| /api/books               | POST     | 本の登録           |
| /api/books/[id]/verify   | POST     | AI概要確認         |
| /api/quests              | POST     | クエスト生成開始   |
| /api/quests/[id]/status  | GET      | 生成状況確認       |
| /api/chapters/[id]/audio | GET      | 音声ファイル取得   |
| /api/purchases           | POST     | 購入処理           |
| /api/purchases/webhook   | POST     | Stripe Webhook     |
| /api/feedbacks           | POST     | フィードバック送信 |
| /api/admin/stats         | GET      | 管理画面統計       |
